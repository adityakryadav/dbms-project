<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Return Leftover Medicines - Genricycle</title>
<link rel="stylesheet" href="/assets/css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .page-wrapper { max-width: 1000px; margin: 0 auto; padding: 2rem 20px; }
        .simple-card { background: #fff; border: 1px solid rgba(46,125,50,0.12); border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.06); margin-bottom: 1.5rem; }
        .back-link { display: inline-flex; align-items: center; gap: .5rem; text-decoration: none; color: #2E7D32; font-weight: 600; margin-bottom: 1rem; }
        .auth-required { text-align: center; padding: 3rem 1rem; }
        .auth-required i { font-size: 3rem; color: #2E7D32; margin-bottom: 1rem; }
        .auth-required h2 { margin-bottom: 1rem; }
        .auth-required button { background: #2E7D32; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; font-weight: 600; cursor: pointer; }
        
        .return-form { display: none; }
        .return-form.active { display: block; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; }
        .form-group textarea { min-height: 100px; }
        
        .medicine-item { display: flex; align-items: center; border: 1px solid #eee; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .medicine-item img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; margin-right: 1rem; }
        .medicine-details { flex: 1; }
        .medicine-name { font-weight: 600; margin-bottom: 0.25rem; }
        .medicine-info { color: #666; font-size: 0.9rem; }
        .medicine-points { font-weight: 600; color: #2E7D32; }
        
        .return-history { margin-top: 2rem; }
        .history-item { border-bottom: 1px solid #eee; padding: 1rem 0; }
        .history-item:last-child { border-bottom: none; }
        .history-date { color: #666; font-size: 0.9rem; }
        .history-status { font-weight: 600; }
        .history-status.pending { color: #FFA000; }
        .history-status.completed { color: #2E7D32; }
        .history-status.rejected { color: #D32F2F; }
        .history-points { font-weight: 600; color: #2E7D32; }
        
        .rewards-info { display: flex; align-items: center; background: #E8F5E9; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; }
        .rewards-info i { font-size: 2rem; color: #2E7D32; margin-right: 1rem; }
        .rewards-text { flex: 1; }
        .rewards-text h3 { margin-bottom: 0.25rem; }
        
        .submit-btn { background: #2E7D32; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 4px; font-weight: 600; cursor: pointer; }
        .submit-btn:hover { background: #1B5E20; }
        
        .steps-container { display: flex; margin-bottom: 2rem; }
        .step { flex: 1; text-align: center; padding: 1rem; position: relative; }
        .step:not(:last-child):after { content: ''; position: absolute; top: 2.5rem; right: 0; width: 100%; height: 2px; background: #ddd; z-index: 0; }
        .step-number { display: inline-flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: #ddd; color: #666; border-radius: 50%; margin-bottom: 0.5rem; position: relative; z-index: 1; }
        .step.active .step-number { background: #2E7D32; color: white; }
        .step.completed .step-number { background: #2E7D32; color: white; }
        .step.completed .step-number:after { content: 'âœ“'; }
        /* Hide global header for a cleaner page-specific layout */
        .header { display: none !important; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
<a href="/pages/home/index.html">Genricycle</a>
                </div>
                <nav class="nav">
                    <ul class="nav-list">
<li><a href="/pages/home/index.html" class="nav-link">Home</a></li>
<li><a href="/pages/donations/donations.html" class="nav-link">Donations</a></li>
<li><a href="/pages/recycle/medicine-return.html" class="nav-link active">Return Medicines</a></li>
<li><a href="/pages/user/rewards.html" class="nav-link">Rewards</a></li>
<li><a href="/pages/help/contact.html" class="nav-link">Contact</a></li>
                        <li>
                            <a href="#" class="nav-link cart-link" onclick="openCartModal(); return false;" style="font-size: 1.2rem; position: relative;">
                                <i class="fas fa-shopping-cart"></i>
                                <span class="cart-count" style="display:none; position:absolute; top:-6px; right:-10px; background:#FF5722; color:#fff; border-radius:50%; font-size:0.7rem; padding:2px 6px; min-width:18px; text-align:center;">0</span>
                            </a>
                        </li>
                        <li class="auth-section">
                            <!-- Auth buttons (shown when logged out) -->
                            <div class="auth-buttons" id="authButtons">
                                <button class="btn-login" onclick="showLoginModal()">Login</button>
                                <button class="btn-signup" onclick="showSignupModal()">Sign Up</button>
                            </div>
                            
                            <!-- Profile dropdown (shown when logged in) -->
                            <div class="profile-dropdown" id="profileDropdown">
                                <div class="profile-trigger" onclick="toggleProfileDropdown()">
                                    <div class="profile-avatar">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <span class="profile-name" id="profileName">John Doe</span>
                                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                                </div>
                                <div class="dropdown-menu" id="dropdownMenu">
<a href="/pages/user/profile.html" class="dropdown-item">
                                        <i class="fas fa-user"></i>
                                        My Profile
                                    </a>
<a href="/pages/user/settings.html" class="dropdown-item">
                                        <i class="fas fa-cog"></i>
                                        Settings
                                    </a>
<a href="/pages/user/transactions.html" class="dropdown-item">
                                        <i class="fas fa-history"></i>
                                        Transaction History
                                    </a>
                                    <a href="#" class="dropdown-item" onclick="logout()">
                                        <i class="fas fa-sign-out-alt"></i>
                                        Logout
                                    </a>
                                </div>
                            </div>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="page-wrapper">
<a href="/pages/home/index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Home</a>
        <section class="hero" style="background:#E8F5E9;">
            <div class="container">
                <h1 style="color:#2E7D32;">Return Leftover Medicines</h1>
                <p>Help reduce waste and earn rewards by returning your unused or expired medicines</p>
            </div>
        </section>
        <!-- Login Required Message (shown when not logged in) -->
        <div class="auth-required" id="authRequiredMessage">
            <i class="fas fa-lock"></i>
            <h2>Login Required</h2>
            <p>You need to be logged in to return medicines and earn rewards.</p>
            <button onclick="showLoginModal()">Login Now</button>
        </div>
        
        <!-- Return Medicine Form (shown when logged in) -->
        <div class="return-form" id="returnForm">
            <div class="rewards-info">
                <i class="fas fa-gift"></i>
                <div class="rewards-text">
                    <h3>Earn Rewards for Returns</h3>
                    <p>Get 50-200 points for each eligible medicine you return, depending on the condition and expiry date.</p>
                </div>
            </div>
            
            <div class="steps-container">
                <div class="step active">
                    <div class="step-number">1</div>
                    <div class="step-title">Fill Details</div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-title">Schedule Pickup</div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-title">Get Rewards</div>
                </div>
            </div>
            
            <div class="simple-card">
                <h2>Medicine Return Form</h2>
                <p>Please provide details about the medicines you want to return.</p>
                
                <form id="medicineReturnForm">
                    <div class="form-group">
                        <label for="medicineType">Medicine Type</label>
                        <select id="medicineType" required>
                            <option value="">Select Medicine Type</option>
                            <option value="tablets">Tablets/Pills</option>
                            <option value="capsules">Capsules</option>
                            <option value="syrups">Syrups/Liquids</option>
                            <option value="inhalers">Inhalers</option>
                            <option value="injections">Injections</option>
                            <option value="creams">Creams/Ointments</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="medicineName">Medicine Name</label>
                        <input type="text" id="medicineName" placeholder="Enter medicine name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="expiryDate">Expiry Date</label>
                        <input type="date" id="expiryDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="quantity">Quantity</label>
                        <input type="number" id="quantity" min="1" value="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="condition">Condition</label>
                        <select id="condition" required>
                            <option value="">Select Condition</option>
                            <option value="unopened">Unopened/Sealed</option>
                            <option value="opened">Opened but unused</option>
                            <option value="partially">Partially used</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="additionalInfo">Additional Information</label>
                        <textarea id="additionalInfo" placeholder="Any additional details about the medicine..."></textarea>
                    </div>
                    
                    <button type="button" class="submit-btn" onclick="addMedicineToReturn()">Add Medicine</button>
                </form>
            </div>
            
            <div class="simple-card" id="medicineListContainer" style="display: none;">
                <h2>Medicines to Return</h2>
                <div id="medicineList"></div>
                
                <div class="form-group">
                    <label for="pickupDate">Preferred Pickup Date</label>
                    <input type="date" id="pickupDate" required>
                </div>
                
                <div class="form-group">
                    <label for="pickupAddress">Pickup Address</label>
                    <textarea id="pickupAddress" placeholder="Enter your complete address for pickup" required></textarea>
                </div>
                
                <button type="button" class="submit-btn" onclick="submitReturnRequest()">Schedule Pickup</button>
            </div>
            
            <div class="return-history simple-card">
                <h2>Your Return History</h2>
                <div id="returnHistoryList">
                    <!-- Return history will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About Genricycle</h3>
                    <p>Providing affordable generic medications and healthcare services to everyone.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
<li><a href="/pages/home/index.html">Home</a></li>
<li><a href="#">About Us</a></li>
<li><a href="/pages/donations/donations.html">Donations</a></li>
<li><a href="/pages/recycle/medicine-return.html">Return Medicines</a></li>
<li><a href="/pages/help/contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Healthcare St, Medical City</p>
                    <p><i class="fas fa-phone"></i> +1 234 567 8901</p>
                    <p><i class="fas fa-envelope"></i> info@genricycle.com</p>
                </div>
                <div class="footer-section">
                    <h3>Follow Us</h3>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Genricycle. All rights reserved.</p>
            </div>
        </div>
    </footer>

<script src="/assets/js/script.js"></script>
    <script>
        // Medicine return data
        let medicinesToReturn = [];
        let returnHistory = [];
        
        // Check login status on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadReturnHistory();
            updateReturnUI();
            
            // Set minimum date for expiry and pickup
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expiryDate').min = today;
            document.getElementById('pickupDate').min = today;
        });
        
        // Update UI based on login status
        function updateReturnUI() {
            const authRequiredMessage = document.getElementById('authRequiredMessage');
            const returnForm = document.getElementById('returnForm');
            
            if (isLoggedIn) {
                authRequiredMessage.style.display = 'none';
                returnForm.classList.add('active');
            } else {
                authRequiredMessage.style.display = 'block';
                returnForm.classList.remove('active');
            }
        }
        
        // Add medicine to return list
        function addMedicineToReturn() {
            const medicineType = document.getElementById('medicineType').value;
            const medicineName = document.getElementById('medicineName').value;
            const expiryDate = document.getElementById('expiryDate').value;
            const quantity = document.getElementById('quantity').value;
            const condition = document.getElementById('condition').value;
            const additionalInfo = document.getElementById('additionalInfo').value;
            
            // Validate form
            if (!medicineType || !medicineName || !expiryDate || !quantity || !condition) {
                showNotification('Please fill all required fields', 'error');
                return;
            }
            
            // Calculate points based on condition and expiry
            let points = calculatePoints(condition, expiryDate);
            
            // Add to list
            const medicine = {
                id: Date.now(),
                type: medicineType,
                name: medicineName,
                expiry: expiryDate,
                quantity: quantity,
                condition: condition,
                additionalInfo: additionalInfo,
                points: points
            };
            
            medicinesToReturn.push(medicine);
            renderMedicineList();
            
            // Reset form
            document.getElementById('medicineReturnForm').reset();
            
            // Show medicine list container
            document.getElementById('medicineListContainer').style.display = 'block';
            
            showNotification(`${medicineName} added to return list`, 'success');
        }
        
        // Calculate reward points based on medicine condition and expiry
        function calculatePoints(condition, expiryDate) {
            const today = new Date();
            const expiry = new Date(expiryDate);
            const monthsDifference = (expiry.getFullYear() - today.getFullYear()) * 12 + (expiry.getMonth() - today.getMonth());
            
            let points = 50; // Base points
            
            // Adjust based on condition
            if (condition === 'unopened') {
                points += 100;
            } else if (condition === 'opened') {
                points += 50;
            }
            
            // Adjust based on expiry
            if (monthsDifference > 6) {
                points += 50;
            } else if (monthsDifference < 0) {
                points -= 25;
            }
            
            return Math.max(50, points); // Minimum 50 points
        }
        
        // Render medicine list
        function renderMedicineList() {
            const medicineList = document.getElementById('medicineList');
            medicineList.innerHTML = '';
            
            let totalPoints = 0;
            
            medicinesToReturn.forEach(medicine => {
                const conditionText = {
                    'unopened': 'Unopened/Sealed',
                    'opened': 'Opened but unused',
                    'partially': 'Partially used'
                }[medicine.condition];
                
                const medicineItem = document.createElement('div');
                medicineItem.className = 'medicine-item';
                medicineItem.innerHTML = `
                    <img src="assets/images/OIP.webp" alt="${medicine.name}">
                    <div class="medicine-details">
                        <div class="medicine-name">${medicine.name}</div>
                        <div class="medicine-info">
                            ${medicine.type} | ${conditionText} | Qty: ${medicine.quantity} | Expires: ${formatDate(medicine.expiry)}
                        </div>
                    </div>
                    <div class="medicine-points">+${medicine.points} points</div>
                    <button onclick="removeMedicine(${medicine.id})" style="background:none; border:none; color:#D32F2F; cursor:pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                medicineList.appendChild(medicineItem);
                totalPoints += medicine.points;
            });
            
            // Add total points
            if (medicinesToReturn.length > 0) {
                const totalItem = document.createElement('div');
                totalItem.style.marginTop = '1rem';
                totalItem.style.textAlign = 'right';
                totalItem.style.fontWeight = 'bold';
                totalItem.innerHTML = `Total Reward: <span style="color:#2E7D32">+${totalPoints} points</span>`;
                medicineList.appendChild(totalItem);
            } else {
                medicineList.innerHTML = '<p>No medicines added yet.</p>';
                document.getElementById('medicineListContainer').style.display = 'none';
            }
        }
        
        // Remove medicine from list
        function removeMedicine(id) {
            medicinesToReturn = medicinesToReturn.filter(medicine => medicine.id !== id);
            renderMedicineList();
            showNotification('Medicine removed from return list', 'info');
        }
        
        // Submit return request
        function submitReturnRequest() {
            const pickupDate = document.getElementById('pickupDate').value;
            const pickupAddress = document.getElementById('pickupAddress').value;
            
            if (!pickupDate || !pickupAddress) {
                showNotification('Please enter pickup date and address', 'error');
                return;
            }
            
            if (medicinesToReturn.length === 0) {
                showNotification('Please add at least one medicine to return', 'error');
                return;
            }
            
            // Calculate total points
            const totalPoints = medicinesToReturn.reduce((sum, medicine) => sum + medicine.points, 0);
            
            // Create return request
            const returnRequest = {
                id: Date.now(),
                date: new Date().toISOString(),
                medicines: [...medicinesToReturn],
                pickupDate: pickupDate,
                pickupAddress: pickupAddress,
                status: 'pending',
                points: totalPoints
            };
            
            // Add to history
            returnHistory.unshift(returnRequest);
            saveReturnHistory();
            
            // Update user points in localStorage
            updateUserPoints(totalPoints);
            
            // Reset form and list
            medicinesToReturn = [];
            document.getElementById('pickupDate').value = '';
            document.getElementById('pickupAddress').value = '';
            document.getElementById('medicineListContainer').style.display = 'none';
            
            // Update history display
            renderReturnHistory();
            
            // Show success message
            showNotification(`Return request submitted successfully! You earned ${totalPoints} points.`, 'success');
            
            // Update steps
            document.querySelectorAll('.step')[0].classList.remove('active');
            document.querySelectorAll('.step')[0].classList.add('completed');
            document.querySelectorAll('.step')[1].classList.remove('active');
            document.querySelectorAll('.step')[1].classList.add('completed');
            document.querySelectorAll('.step')[2].classList.add('active');
        }
        
        // Update user points
        function updateUserPoints(points) {
            // Get current user
            const userData = JSON.parse(localStorage.getItem('genricycle_user')) || 
                             JSON.parse(localStorage.getItem('userData'));
            
            if (userData) {
                // Add points to user
                userData.points = (userData.points || 0) + points;
                
                // Save updated user data
                localStorage.setItem('genricycle_user', JSON.stringify(userData));
                if (localStorage.getItem('userData')) {
                    localStorage.setItem('userData', JSON.stringify(userData));
                }
            }
        }
        
        // Load return history from localStorage
        function loadReturnHistory() {
            const savedHistory = localStorage.getItem('medicine_return_history');
            if (savedHistory) {
                returnHistory = JSON.parse(savedHistory);
                renderReturnHistory();
            }
        }
        
        // Save return history to localStorage
        function saveReturnHistory() {
            localStorage.setItem('medicine_return_history', JSON.stringify(returnHistory));
        }
        
        // Render return history
        function renderReturnHistory() {
            const historyList = document.getElementById('returnHistoryList');
            
            if (returnHistory.length === 0) {
                historyList.innerHTML = '<p>No return history yet.</p>';
                return;
            }
            
            historyList.innerHTML = '';
            
            returnHistory.forEach(request => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const statusClass = {
                    'pending': 'pending',
                    'completed': 'completed',
                    'rejected': 'rejected'
                }[request.status];
                
                historyItem.innerHTML = `
                    <h3>Return Request #${request.id.toString().slice(-4)}</h3>
                    <p class="history-date">Submitted on ${formatDate(request.date)}</p>
                    <p>Pickup scheduled for ${formatDate(request.pickupDate)}</p>
                    <p>Medicines: ${request.medicines.length} item(s)</p>
                    <p>Status: <span class="history-status ${statusClass}">${request.status.charAt(0).toUpperCase() + request.status.slice(1)}</span></p>
                    <p class="history-points">+${request.points} points</p>
                `;
                
                historyList.appendChild(historyItem);
            });
        }
        
        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }
    </script>
</body>
</html>